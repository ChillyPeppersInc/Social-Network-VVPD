<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: commonHead(~{::specific-head})}">
    <th:block th:fragment="specific-head">
        <link th:href="@{/css/index.css}" rel="stylesheet">
        <link th:href="@{/css/profile.css}" rel="stylesheet">
        <title>профиль</title>
    </th:block>
</head>

<body>
    <div th:insert="~{fragments/header :: header}"></div>

    <div class="profile-page animate__animated animate__fadeIn">
        <div class="profile-sidebar">
            <img th:if="${profileUser.avatar == null}" th:src="@{/images/avatars/default-avatar.png}" class="profile-avatar">
            <img th:if="${profileUser.avatar != null}" th:src="${profileUser.avatar}" class="profile-avatar">

            <h2 class="profile-name">
                <span th:text="${profileUser.name}"></span>
                <span th:text="${profileUser.surname}"></span>
            </h2>
            <p class="profile-username" th:text="'@' + ${profileUser.username}"></p>
            <div class="profile-follows">
                <span class="follows-count">
                    <a th:href="@{/followers}" th:text="${profileUser.followersCount} + ' подписчиков'" class="follow-link"></a>
                </span>
                 |
                <span class="follows-count">
                    <a th:href="@{/follows}" th:text="${profileUser.followersCount} + ' подписок'" class="follow-link"></a>
                </span>
            </div>

            <div class="profile-info">
                <div class="info-item" th:if="${profileUser.bio != null && profileUser.bio.length() != 0}">
                    <div class="info-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="info-content">
                        <div class="info-label">О себе</div>
                        <div class="info-value" th:text="${profileUser.bio}"></div>
                    </div>
                </div>

                <div class="info-item">
                    <div class="info-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="info-content">
                        <div class="info-label">Группа</div>
                        <div class="info-value" th:text="${profileUser.academicGroup}"></div>
                    </div>
                </div>

                <div class="info-item">
                    <div class="info-icon">
                        <i class="fas fa-birthday-cake"></i>
                    </div>
                    <div class="info-content">
                        <div class="info-label">Дата рождения</div>
                        <div class="info-value" th:text="${#temporals.format(profileUser.birthdate, 'dd.MM.yyyy')}"></div>
                    </div>
                </div>
            </div>
        </div>


        <div class="comments-section" style="max-height: 632px; overflow-y: auto;">
            <h3 class="section-title">
                <span class="posts-title" onclick="showPosts()">
                    <i class="fas fa-bullhorn"></i> Публикации
                </span>
                <i style="padding-right: 15px"></i>
                <span class="comments-title" onclick="showComments()">
                    <i class="fas fa-comments"></i> Комментарии
                </span>
                <span class="add-post-btn" onclick="openCreatePostModal()" title="Добавить пост">
                    <i class="fas fa-plus"></i>
                </span>
            </h3>

            <div th:each="post : ${profileUser.posts}" class="posts">
                <div class="comment">
                    <img th:if="${post.user.avatar == null}" th:src="@{/images/avatars/default-avatar.png}" class="comment-avatar">
                    <img th:if="${post.user.avatar != null}" th:src="${post.user.avatar}" class="comment-avatar">

                    <div class="comment-content">
                        <div class="comment-header">
                            <span th:text="${post.user.name} + ' ' + ${post.user.surname}" class="comment-author"></span>
                            <span class="comment-date">
                                <span th:text="${#temporals.format(post.createdAt, 'dd.MM.yyyy')}"></span>
                                <span> в </span>
                                <span th:text="${#temporals.format(post.createdAt, 'HH:mm')}"></span>
                            </span>
                        </div>
                        <p th:text="${post.content}" class="comment-text"></p>
                        <div class="comment-actions">
                            <span class="comment-action like-button" onclick="handleLike(this)"><i class="far fa-thumbs-up"></i> Нравится (<span class="like-count">0</span>)</span>
                        </div>
                    </div>
                </div>

                <!--<div class="comment">
                    <img th:src="@{/images/avatars/kamil.jpg}" class="comment-avatar">
                    <div class="comment-content">
                        <div class="comment-header">
                            <span class="comment-author">Камиль Хуззятов</span>
                            <span class="comment-date">27.05.2025 в 22:20</span>
                        </div>
                        <p class="comment-text">Всем привет!!!</p>
                        <div class="comment-actions">
                            <span class="comment-action like-button" onclick="handleLike(this)"><i class="far fa-thumbs-up"></i> Нравится (<span class="like-count">0</span>)</span>
                        </div>
                    </div>
                </div>-->
            </div>



            <div class="comments">
                <div class="comment">
                    <img th:src="@{/images/avatars/anton.jpg}" class="comment-avatar">
                    <div class="comment-content">
                        <div class="comment-header">
                            <span class="comment-author">Антон Котельников</span>
                            <span class="comment-date">27.05.2025 в 22:20</span>
                        </div>
                        <p class="comment-text">привет</p>
                        <div class="comment-actions">
                            <span class="comment-action"><i class="fas fa-reply"></i> Ответить</span>
                            <span class="comment-action like-button" onclick="handleLike(this)"><i class="far fa-thumbs-up"></i> Нравится (<span class="like-count">0</span>)</span>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>

    <!-- Добавьте этот код перед закрывающим тегом </body> -->
    <div id="createPostModal" class="modal">
      <div class="modal__content">
        <button class="modal__close" onclick="closeCreatePostModal()" aria-label="Закрыть">&times;</button>
        <div class="modal__header">
          <h2 class="modal__title">Создать пост</h2>
        </div>
        <form id="postForm" class="post-form" method="POST" th:action="@{/api/post_create}" enctype="multipart/form-data">
          <textarea id="content" name="content" class="post-form__textarea" placeholder="Что у вас нового?"></textarea>
          <input type="file" id="image" name="image" accept="image/*">
          <div class="modal__actions">
            <button type="button" class="button button--secondary" onclick="closeCreatePostModal()">Отмена</button>
            <button type="submit" class="button button--primary">Опубликовать</button>
          </div>
        </form>
      </div>
    </div>

    <script th:src="@{/js/profile.js}"></script>
</body>
</html>